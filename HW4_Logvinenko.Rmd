---
title: "Untitled"
output: html_document
date: "2024-04-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}

library(readxl)
library(tidyverse)
library(ggplot2)
```

Задание 1. Рассмотрите следующую статистическую гипотезу. Проводят некоторое исследование пациентов с артериальной гипертензией. Предположим, что внедрение нового препарата в среднем лучше снижает их давление по сравнению со стандартной терапией.

Задайте seed для воспроизводимости результатов (функция set.seed()). Задайте размер выборки sample_size <- 30. Задайте значение среднего артериального давления до приема нового препарата и после.

Сформулируйте нулевую и альтернативную гипотезы.

Определите уровень значимости.

Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

Определите наблюдаемое значение статистики, а также критическое значение статистики.

Оцените и прокомментируйте статистическую значимость.

```{r}
set.seed(123)  # задаем seed для воспроизводимости результатов

sample_size <- 30  

# генерация выборки среднего артериального давления до приема нового препарата
before_treatment_systolic <- rnorm(n = sample_size, mean = 170, sd = 5)  
# среднее систолического давления 170

before_treatment_diastolic <- rnorm(n = sample_size, mean = 105, sd = 5)  
# среднее диастолического давления 105

# генерация выборки среднего артериального давления после приема нового препарата
after_treatment_systolic <- rnorm(n = sample_size, mean = 140, sd = 5)  
# среднее систолического давления 140

after_treatment_diastolic <- rnorm(n = sample_size, mean = 90, sd = 5) 
# среднее диастолического давления 90
```

```{r}
# создание датафрейма
data_AD <- data.frame(
  beforeS_systolic = before_treatment_systolic,
  beforeS_diastolic = before_treatment_diastolic,
  afterS_systolic = after_treatment_systolic,
  afterS_diastolic = after_treatment_diastolic
)
 head(data_AD)
```
```{r}
# вычисление описательных статистик
summary_data_AD <- summary(data_AD)

# вывод описательных статистик
print(summary_data_AD)
```
H0: разницы между группами beforeS_systolic и afterS_systolic, а так же между beforeS_diastolic и afterS_diastolic нет.

H1: разница между анализируемыми группами есть.

Уровень значимости alpha (α) - 0.05 (или 5%). Это наиболее часто используемый уровень значимости в большинстве исследований биомедицинской сферы. Этот уровень значимости предполагает, что если p-value (вероятность получить наблюдаемый результат или более экстремальный при условии верности нулевой гипотезы) меньше 0.05, то результат считается статистически значимым.

```{r}
# создаем пустой список для хранения результатов теста Шапиро-Уилка
shapiro_results <- list()

# применяем тест Шапиро-Уилка к каждому столбцу датафрейма
for (col in colnames(data_AD)) {
  shapiro_results[[col]] <- shapiro.test(data_AD[[col]])
}

# выводим результаты теста
for (col in names(shapiro_results)) {
  cat("Тест Шапиро-Уилка для столбца", col, ":\n")
  print(shapiro_results[[col]])
  cat("\n")
}
```
p-value > 0.05 - нулевую гипотезу(H0) о нормальности распределения принимаем. Для проверки гипотезы есть ли различия между группами или нет (beforeS_systolic и afterS_systolic, beforeS_diastolic и afterS_diastolic) воспользуемся t-тестом.


```{r}
# выполнение t-теста для систолического давления
systolic_t_test <- t.test(data_AD$beforeS_systolic, data_AD$afterS_systolic, 
                          paired = TRUE)

# вывод результатов
print("Результаты t-теста для систолического давления:")
print(systolic_t_test)

# выполнение t-теста для диастолического давления
diastolic_t_test <- t.test(data_AD$beforeS_diastolic, data_AD$afterS_diastolic, paired = TRUE)

print("Результаты t-теста для диастолического давления:")
print(diastolic_t_test)
```

p-value < 0.05 H0 (разницы между группами beforeS_systolic и afterS_systolic, а так же между beforeS_diastolic и afterS_diastolic нет) - отвергаем в пользу H1 (разница между анализируемыми группами есть).

t = 27.08 и t = 15.11 это наблюдаемые значения статистики t для 29 степеней свободы (n - 1) (df) Чтобы определить критическое значение статистики t для заданного уровня значимости (α = 0.05), воспользуемся квантильной функцией t-распределения qt().

```{r}
alpha <- 0.05
critical_value <- qt(1 - alpha/2, df = 29)
print(critical_value)
```

Если наблюдаемое значение t превышает критическое значение, то мы можем заключить, что наши данные противоречат нулевой гипотезе на заданном уровне значимости. Т.е. разница между анализируемыми группами есть и новый препарат в среднем лучше снижает давление по сравнению со стандартной терапией.


Задание 2. Рассмотрите следующую статистическую гипотезу. Существует некоторая связь между курением и развитием рака легких. Пусть у курящих людей вероятность заболеть раком легких составляет 0.8, а у некурящих — 0.2

Рассмотрите два случая: для выборки sample_size1 <- 100 и выборки sample_size2 <- 30. Сгенерируйте данные по курению с помощью функции rep(), пусть отношение числа курящих к некурящим в каждой выборке составляет 1:1.

Сформулируйте нулевую и альтернативную гипотезы.

Определите уровень значимости.

Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

Определите наблюдаемое значение статистики, а также критическое значение статистики.

Оцените и прокомментируйте статистическую значимость.

```{r}
#создаем выборки с указанным в условии размером, которые состоят пополам из курящих и не курящих, тип переменной класса factor, где курящие обозначаются числом 1, а некурящие - числом 0.
set.seed(123)

sample_size1 <- 100
sample_size2 <- 30

# создание векторов для каждой выборки
smokers_sample1 <- rep(factor(c(1, 0)), each = sample_size1/2)
smokers_sample2 <- rep(factor(c(1, 0)), each = sample_size2/2)
```

```{r}
# формируем Вероятности заболевания раком легких
prob_smoker <- 0.8
prob_non_smoker <- 0.2

# генерация случайных чисел для каждой выборки с учетом вероятностей
lung_cancer_smokers_sample1 <- sample(c(1, 0), size = sample_size1/2, replace = TRUE, prob = c(prob_smoker, 1 - prob_smoker))
lung_cancer_smokers_sample2 <- sample(c(1, 0), size = sample_size2/2, replace = TRUE, prob = c(prob_smoker, 1 - prob_smoker))

lung_cancer_non_smokers_sample1 <- sample(c(1, 0), size = sample_size1/2, replace = TRUE, prob = c(prob_non_smoker, 1 - prob_non_smoker))
lung_cancer_non_smokers_sample2 <- sample(c(1, 0), size = sample_size2/2, replace = TRUE, prob = c(prob_non_smoker, 1 - prob_non_smoker))

print(smokers_sample1)
 head(lung_cancer_smokers_sample1)
```

```{r}
# создание датафреймов для каждой выборки
df_sample1 <- data.frame(
  smokers = smokers_sample1,
  lung_cancer = c(lung_cancer_smokers_sample1, lung_cancer_non_smokers_sample1)
)

df_sample2 <- data.frame(
  smokers = smokers_sample2,
  lung_cancer = c(lung_cancer_smokers_sample2, lung_cancer_non_smokers_sample2)
)

```

H0: не наблюдаем различий, т.е. курение не оказывает влияния на возникновение рака легкого.

H1: различия есть, т.е. курение оказывает влияния на возникновение рака легкого.

Определяем уровень значимости alpha (α) - 0.05 (или 5%). Это наиболее часто используемый уровень значимости в большинстве исследований биомедицинской сферы. Этот уровень значимости предполагает, что если p-value (вероятность получить наблюдаемый результат или более экстремальный при условии верности нулевой гипотезы) меньше 0.05, то результат считается статистически значимым.

Построим таблицу сопряженности, она используется для сравнения двух категориальных переменных и оценки связи между ними. В данном случае, построение таблицы сопряженности помогает нам определить, есть ли разница в распределении случаев рака легких среди курящих и некурящих людей.

```{r}
  # создание таблицы сопряженности с названиями
  table_data1 <- table(df_sample1$smokers, df_sample1$lung_cancer)
  dimnames(table_data1) <- list(
  Smoking_Status = c("Non-Smoker", "Smoker"),
  Lung_Cancer = c("No", "Yes")
)
  print(table_data1)

  
  # создание таблицы сопряженности с названиями
  table_data2 <- table(df_sample2$smokers, df_sample2$lung_cancer)
  dimnames(table_data2) <- list(
  Smoking_Status = c("Non-Smoker", "Smoker"),
  Lung_Cancer = c("No", "Yes")
)
  print(table_data2)  
```
Итак, здесь мы можем увидеть, что среди курящих людей более высок процент случаев рака легких, чем среди некурящих. Это наблюдение может стать основой для более глубокого анализа, включая статистические тесты, такие как тест Фишера, для определения статистической значимости этой связи.
Тестом Фишера можно применить для проверки выдвинутой гипотезы, когда: данные категориальные, небольшой размер выборки и  отсутствуют другие факторы влияния. 

```{r}
# проведение теста Фишера для первой выборки df_sample1
fisher_test_result <- fisher.test(table(df_sample1$smokers, df_sample1$lung_cancer))
print (fisher_test_result)
```

```{r}
# проведение теста Фишера для второй выборки df_sample2 
fisher_test_result2 <- fisher.test(table(df_sample2$smokers, df_sample2$lung_cancer))
print (fisher_test_result2)
```

Нулевая гипотеза(Н0) отклоняется на уровне значимости α = 0.05,  p-значения (8.307e-09 и 0.0001451), сильно меньше уровня значимости 0.05.
В точном тесте Фишера не используются понятия наблюдаемого значения статистики или критического значения статистики, поскольку в этом тесте p-value вычисляется непосредственно на основе таблицы сопряженности. Эта таблица отражает частоты событий в контингентной таблице. Исходя из этих частот, рассчитывается p-value, который показывает вероятность получить наблюдаемые данные или более экстремальные при условии справедливости нулевой гипотезы.



Задание 3.Рассмотрите следующую статистическую гипотезу.  Применение нового метода лечения синдрома раздраженного кишечника  значимо меняет уровень болевых симптомов по сравнению с группой,  прошедшей лечение диетотерапией.

Исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение. 

Что нужно сделать:

Сформулируйте нулевую и альтернативную гипотезы.

 Определите уровень значимости.

 Выберите статистический тест для проверки гипотезы и аргументируйте свой выбор.

 Определите наблюдаемое значение статистики, а также критическое значение статистики.

 Оцените и прокомментируйте статистическую значимость.

Для оценки болевых симптомов воспользуемся визуальной аналоговой шкалой боли (ВАШ).      Интерпретация: 0 баллов – нет нарушений; 1–3 балла – легкая боль (легкие нарушения); 4-6 баллов – умеренная боль (умеренные нарушения); 7-8 баллов – выраженная боль (тяжелые нарушения); 9-10 баллов – невыносимая боль (абсолютные нарушения).



```{r}
set.seed(42)
sample_size <- 50

# генерация выборок для нового метода лечения
new_method_group <- sample(x = c(0:3, 4:6, 7:8, 8:8), size = sample_size, replace = TRUE)

# венерация выборок для диетотерапии с другими значениями
diet_therapy_group <- sample(x = c(0:2, 3:5, 6:7, 9:10), size = sample_size, replace = TRUE)

# воздание датафрейма с данными
full_data <- data.frame(New_method = new_method_group, Dietotherapy = diet_therapy_group)

# вывод первых нескольких строк датафрейма
head(full_data)
```

H0: не наблюдаем различий, т.е. новый метод лечения не меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

H1: различия есть, т.е. новый метод лечения меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

Зададим уровень значимости alpha (α) - 0.05 (или 5%). Этот уровень значимости предполагает, что если p-value (вероятность получить наблюдаемый результат или более экстремальный при условии верности нулевой гипотезы) меньше 0.05, то результат считается статистически значимым. 

```{r}
# столбчатая диаграмма для выборки new_method_group
barplot(table(new_method_group), main = "New Method Group", xlab = "Values", ylab = "Frequency")

# столбчатая диаграмма для выборки diet_therapy_group
barplot(table(diet_therapy_group), main = "Diet Therapy Group", xlab = "Values", ylab = "Frequency")
```

```{r}
# проверка нормальности распределения для new_method_group
shapiro_test_new_method <- shapiro.test(new_method_group)
print("Shapiro-Wilk test for New Method Group:")
print(shapiro_test_new_method)

# проверка нормальности распределения для diet_therapy_group
shapiro_test_diet_therapy <- shapiro.test(diet_therapy_group)
print("Shapiro-Wilk test for Diet Therapy Group:")
print(shapiro_test_diet_therapy)
```

Интервал аналоговой шкалы боли имеют дискретный характер, что подразумевает наличие дискретного распределения.  Визуальная оценка распределения по столбчатым диаграммам говорит об отсутствии нормального распределения.  Тест Шапиро-Вилка (для которого Н0: распределение данных в выборке является нормальным) подтверждает что распределение не является нормальным, хотя для второй группы p-значение = 0.02073, также меньше стандартного уровня значимости 0.05, но намного ближе к нему, нулевую гипотезу мы все равно отклоняем.    Для оценки значимости различий между двумя методами лечения можно использовать непараметрические аналоги t-тестов, например, тест Манна-Уитни.

```{r}
# оценка значимости различий между группами с помощью теста Манна-Уитни
wilcox_test_result <- wilcox.test(new_method_group, diet_therapy_group)

print(wilcox_test_result)
```

В тесте Манна-Уитни наблюдаемое значение статистики — это значение W, которое отражает сумму рангов, присвоенных данным в двух группах. Это значение используется для вычисления p-значения.
Т.к.  критическое значение статистики не определяется в этом тесте, поскольку его интерпретация не требуется для оценки статистической значимости. Мы принимаем решение об отвержении или принятии нулевой гипотезы, исходя из p-значения. p-value > 0,05 мы не можем отклонить нулевую гипотезу и не можем ничего сказать о различии двух методов лечения по оценке болевых симптомов. 


Задание 4 Рассмотрите следующую гипотезу.
Проводится исследование, в котором исследуются три противоопухолевые препарата A, B плацебо (0) на трех группах мышей. В каждой из трех групп по 10 мышей.  Оценивается размер опухоли у мыши.
Сгенерируйте датасет следующим образом:
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

Постройте на одном графике три «ящика с усами» для наглядности.Проведите дисперсионный анализ, чтобы выяснить, есть ли разница между размером опухоли во всех группах. 
    Прокомментируйте получившийся результат.
    С помощью функции TukeyHSD() проведите попарные сравнения, используя критерий Тьюки.
    Прокомментируйте полученные результаты.


```{r}
# создание датасета
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

# построение ящиков с усами
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(x = "Therapy", y = "Tumor Size", title = "Tumor Size by Therapy")
```
Визуально можно сказать что терапия обоими преператами снижает размер опухоли. 

```{r}
# проведение дисперсионного анализа (ANOVA)
anova_result <- aov(value ~ therapy, data = tumor)

summary(anova_result)

```
p-value = 0.0407,это конечно формально меньше уровня значимости 0.05, но все же такая достоверность принимается с натяжкой. мы можем сказать, что средние значения размера опухолей в разных группах отличаются друг от друга в среднем на 3.612 стандартных отклонения.

Исходя из результатов, видно, что существует статистически значимая разница между группами по размеру опухоли (therapy), так как p-значение меньше 0.05. Однако, для определения конкретной разницы между группами, обычно используются дополнительные тесты, такие как тесты попарных сравнений с поправкой на множественные сравнения, например тест Тьюки.


```{r}
# проведение попарных сравнений с использованием критерия Тьюки
tukey_result <- TukeyHSD(anova_result)

print(tukey_result)
```

Из этой таблицы видно, что между группами A и 0, а также между группами B и 0, существует тенденция к различию в размере опухоли, но эти различия не являются статистически значимыми на уровне значимости 0.05 (после множественной коррекции). Различие между группами B и A также не является статистически значимым.


























